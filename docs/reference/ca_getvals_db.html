<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Write values from an API request to a local database — ca_getvals_db • caladaptr</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Write values from an API request to a local database — ca_getvals_db"><meta name="description" content="Write values from an API request to a local database"><meta property="og:description" content="Write values from an API request to a local database"><meta property="og:image" content="https://ucanr-igis.github.io/caladaptr/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">caladaptr</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/api-requests.html">API Requests</a></li>
    <li><a class="dropdown-item" href="../articles/large-queries.html">Large Queries</a></li>
    <li><a class="dropdown-item" href="../articles/rasters-pt1.html">Rasters Part I: Download, Combine, Subset, and Compute Pixel Summaries</a></li>
    <li><a class="dropdown-item" href="../articles/rasters-pt2.html">Rasters Part II: Six-Dimensional Climate Data Cubes and Spatial Queries</a></li>
    <li><a class="dropdown-item" href="../articles/rasters-pt3.html">Rasters Part III: Downloading Rasters for Large Areas</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-notebooks" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Notebooks</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-notebooks"><li><a class="dropdown-item" href="https://ucanr-igis.github.io/caladaptr-res/notebooks/caladaptr_intro.nb.html">Introduction</a></li>
    <li><a class="dropdown-item" href="https://ucanr-igis.github.io/caladaptr-res/notebooks/chill.nb.html">Compute Chill</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-shiny-apps" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Shiny Apps</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-shiny-apps"><li><a class="external-link dropdown-item" href="https://caladaptr.shinyapps.io/timeseries/">Annual Data Time Series</a></li>
    <li><a class="external-link dropdown-item" href="https://ucanr-igis.shinyapps.io/chill/">Projected Chill Hours</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ucanr-igis/caladaptr.apps/">caladpatr.apps package</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-videos" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Videos</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-videos"><li><a class="external-link dropdown-item" href="https://youtu.be/6sDwXPbSYOQ">caladaptR Overview</a></li>
    <li><a class="external-link dropdown-item" href="https://youtu.be/APCIBs35BJg">Code Demo</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-workshops" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Workshops</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-workshops"><li><a class="dropdown-item" href="https://ucanr-igis.github.io/caladaptr-res/workshops/ca_intro_apr22/">Working with Cal-Adapt Climate Data in R (April 2022)</a></li>
    <li><a class="dropdown-item" href="https://ucanr-igis.github.io/caladaptr-res/workshops/ca_intro_oct21/">Getting Started (Oct 2021)</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/ucanr-igis/caladaptr/"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Write values from an API request to a local database</h1>
      <small class="dont-index">Source: <a href="https://github.com/ucanr-igis/caladaptr/blob/master/R/ca_getvals_db.R" class="external-link"><code>R/ca_getvals_db.R</code></a></small>
      <div class="d-none name"><code>ca_getvals_db.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Write values from an API request to a local database</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ca_getvals_db</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">db_fn</span>,</span>
<span>  <span class="va">db_tbl</span>,</span>
<span>  omit_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  indices <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  new_recs_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  trans_len <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  lookup_tbls <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lookup_ret_joined <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pause_n <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  pause_secs <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  write_sidecar <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  stop_on_err <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A Cal-Adapt API request</p></dd>


<dt id="arg-db-fn">db_fn<a class="anchor" aria-label="anchor" href="#arg-db-fn"></a></dt>
<dd><p>File name of a SQLite database. See Details.</p></dd>


<dt id="arg-db-tbl">db_tbl<a class="anchor" aria-label="anchor" href="#arg-db-tbl"></a></dt>
<dd><p>The name of a database table. See Details.</p></dd>


<dt id="arg-omit-col">omit_col<a class="anchor" aria-label="anchor" href="#arg-omit-col"></a></dt>
<dd><p>Columns to exclude from the tibble</p></dd>


<dt id="arg-indices">indices<a class="anchor" aria-label="anchor" href="#arg-indices"></a></dt>
<dd><p>Name of fields to index. See Details.</p></dd>


<dt id="arg-new-recs-only">new_recs_only<a class="anchor" aria-label="anchor" href="#arg-new-recs-only"></a></dt>
<dd><p>Write new records only to the database. See Details.</p></dd>


<dt id="arg-trans-len">trans_len<a class="anchor" aria-label="anchor" href="#arg-trans-len"></a></dt>
<dd><p>Number of APIs calls per write transaction. See Details.</p></dd>


<dt id="arg-lookup-tbls">lookup_tbls<a class="anchor" aria-label="anchor" href="#arg-lookup-tbls"></a></dt>
<dd><p>Use lookup tables</p></dd>


<dt id="arg-lookup-ret-joined">lookup_ret_joined<a class="anchor" aria-label="anchor" href="#arg-lookup-ret-joined"></a></dt>
<dd><p>Return a table with lookup table fields, ignored if lookup_tbls = FALSE. See Details.</p></dd>


<dt id="arg-pause-n">pause_n<a class="anchor" aria-label="anchor" href="#arg-pause-n"></a></dt>
<dd><p>Number of API calls after which a built-in pause is triggered. See Details.</p></dd>


<dt id="arg-pause-secs">pause_secs<a class="anchor" aria-label="anchor" href="#arg-pause-secs"></a></dt>
<dd><p>Number of seconds to pause. See Details.</p></dd>


<dt id="arg-write-sidecar">write_sidecar<a class="anchor" aria-label="anchor" href="#arg-write-sidecar"></a></dt>
<dd><p>Save table metadata in a separate file. See Details.</p></dd>


<dt id="arg-stop-on-err">stop_on_err<a class="anchor" aria-label="anchor" href="#arg-stop-on-err"></a></dt>
<dd><p>Stop if the server returns an error</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Suppress messages</p></dd>


<dt id="arg-debug">debug<a class="anchor" aria-label="anchor" href="#arg-debug"></a></dt>
<dd><p>Print additional output at the console</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A remote tibble linked to the SQLite database.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>ca_getvals_db</code> fetches data from the Cal-Adapt API and writes the data to a SQLite database as they're received. This
allows you to fetch relatively large volumes of data in the background, and potentially over multiple sessions as it will
pick up where it left off if interrupted. Saving the values in a database also reduces the risk of exhausting your RAM.</p>
<p>Use <code>ca_getvals_db</code> to fetch large volumes of data (i.e., hundreds of thousands of values), or whenever you'd like
to keep  a local copy of the data. Note however for small amounts of data there is no advantage to putting it in a database
as it will be slighly slower to retrieve and work with.</p>
<p><code>db_fn</code> should be a file name with path to a SQLite database. A SQLIte database is a single file typically
with a <em>.db</em> or <em>.sqlite</em> extension. If the database doesn't exist, it will be created. If it already
exists, the new data will be added to it.</p>
<p><code>db_tbl</code> should the name of a table within the database where the new data will be saved. The table name should not
contain special characters and spaces are discouraged. If <code>new_recs_only = TRUE</code>, only new records will be
added to the database.</p>
<p><code>trans_len</code> defines the number of API calls per
<a href="https://www.sqlitetutorial.net/sqlite-transaction/" class="external-link">SQLite transaction</a> (i.e. how many API calls of data to
accumulate before doing a write operation to the database). This can speed things up. Set it to 0 to disable transactions.</p>
<p>If <code>lookup_tbls = TRUE</code>, the database will create lookup tables for categorical columns such as GCM, scenario,
cvar, period, slug, etc. This can dramatically reduce the size of the SQLite database file and is generally recommended.
id <code>lookup_ret_joined = TRUE</code>, the tibble returned will have the lookup tables joined (i.e., column names will
be unaltered); if not the returned tibble will have id values for certain values. A small text file is created for each SQLite
database containing the names of the tables and SQL statement to join them (read automatically
by <code><a href="ca_db_read.html">ca_db_read</a></code>).</p>
<p><code>indices</code> is a vector of column names in <code>db_tbl</code> that you'd like indexed (ignored if <code>lookup_tbls = FALSE</code>).
Creating indices can improve the performance of filters and joins when you generate summaries, but at the cost of a larger
database file and slightly slower write operations. Fields you can create indices on include <code>"feat_id"</code> (the location id value),
<code>"cvar"</code>, <code>"gcm"</code>, <code>"scenario"</code>, <code>"period"</code>, <code>"slug"</code>, and <code>"spag"</code>.</p>
<p>Indices can also be added to a SQLite database after downloading is complete with <a href="ca_db_indices.html">ca_db_indices</a>. For large queries (e.g. thousands of
API calls), it is recommended to not build indices during the download process, and only add indices for those fields you
plan to filter on or join during your analysis. You can view which indices exist with <code><a href="ca_db_info.html">ca_db_info</a></code>.</p>
<p><code>pause_n</code> is the number of API calls after which a built-in pause of length <code>pause_secs</code> is triggered. This is intended
to avoid disruption on the Cal-Adapt server. The maximum value for <code>pause_n</code> is 2500, and the minimum value
for <code>pause_secs</code> is 30 seconds.</p>
<p>The returned tibble is linked to the SQLite datbase. For the most part you can use the same dplyr functions to manipulate
the results, but to retrieve the actual values you need to use `collect()`. For more info working with a linked database,
see <a href="https://dbplyr.tidyverse.org/articles/dbplyr.html" class="external-link">https://dbplyr.tidyverse.org/articles/dbplyr.html</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="ca_db_info.html">ca_db_info</a></code>, <code><a href="ca_db_indices.html">ca_db_indices</a></code>, <code><a href="ca_db_read.html">ca_db_read</a></code>,</p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andy Lyons.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

