<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Write values from an API request to a local database — ca_getvals_db • caladaptr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Write values from an API request to a local database — ca_getvals_db" />
<meta property="og:description" content="Write values from an API request to a local database" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-81567502-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-81567502-3');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">caladaptr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/api-requests.html">API Requests</a>
    </li>
    <li>
      <a href="../articles/large-queries.html">Large Queries</a>
    </li>
    <li>
      <a href="../articles/rasters-pt1.html">Rasters Part I: Download, Combine, Subset, and Compute Pixel Summaries</a>
    </li>
    <li>
      <a href="../articles/rasters-pt2.html">Rasters Part II: Six-Dimensional Climate Data Cubes and Spatial Queries</a>
    </li>
    <li>
      <a href="../articles/rasters-pt3.html">Rasters Part III: Downloading Rasters for Large Areas</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R Notebooks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://ucanr-igis.github.io/caladaptr-res/notebooks/caladaptr_intro.nb.html">Introduction</a>
    </li>
    <li>
      <a href="https://ucanr-igis.github.io/caladaptr-res/notebooks/chill.nb.html">Compute Chill</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Shiny Apps
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://caladaptr.shinyapps.io/timeseries/">Annual Data Time Series</a>
    </li>
    <li>
      <a href="https://ucanr-igis.shinyapps.io/chill/">Projected Chill Hours</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Presentations
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://ucanr-igis.github.io/caladaptr-res/pres/overview.html">Overview</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ucanr-igis/caladaptr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Write values from an API request to a local database</h1>
    <small class="dont-index">Source: <a href='https://github.com/ucanr-igis/caladaptr/blob/master/R/ca_getvals_db.R'><code>R/ca_getvals_db.R</code></a></small>
    <div class="hidden name"><code>ca_getvals_db.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Write values from an API request to a local database</p>
    </div>

    <pre class="usage"><span class='fu'>ca_getvals_db</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>db_fn</span>,
  <span class='va'>db_tbl</span>,
  omit_col <span class='op'>=</span> <span class='cn'>NULL</span>,
  indices <span class='op'>=</span> <span class='cn'>NULL</span>,
  new_recs_only <span class='op'>=</span> <span class='cn'>TRUE</span>,
  trans_len <span class='op'>=</span> <span class='fl'>100</span>,
  lookup_tbls <span class='op'>=</span> <span class='cn'>TRUE</span>,
  lookup_ret_joined <span class='op'>=</span> <span class='cn'>TRUE</span>,
  pause_n <span class='op'>=</span> <span class='fl'>1000</span>,
  pause_secs <span class='op'>=</span> <span class='fl'>60</span>,
  write_sidecar <span class='op'>=</span> <span class='cn'>TRUE</span>,
  stop_on_err <span class='op'>=</span> <span class='cn'>TRUE</span>,
  quiet <span class='op'>=</span> <span class='cn'>FALSE</span>,
  debug <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A Cal-Adapt API request</p></td>
    </tr>
    <tr>
      <th>db_fn</th>
      <td><p>File name of a SQLite database. See Details.</p></td>
    </tr>
    <tr>
      <th>db_tbl</th>
      <td><p>The name of a database table. See Details.</p></td>
    </tr>
    <tr>
      <th>omit_col</th>
      <td><p>Columns to exclude from the tibble</p></td>
    </tr>
    <tr>
      <th>indices</th>
      <td><p>Name of fields to index. See Details.</p></td>
    </tr>
    <tr>
      <th>new_recs_only</th>
      <td><p>Write new records only to the database. See Details.</p></td>
    </tr>
    <tr>
      <th>trans_len</th>
      <td><p>Number of APIs calls per write transaction. See Details.</p></td>
    </tr>
    <tr>
      <th>lookup_tbls</th>
      <td><p>Use lookup tables</p></td>
    </tr>
    <tr>
      <th>lookup_ret_joined</th>
      <td><p>Return a table with lookup table fields, ignored if lookup_tbls = FALSE. See Details.</p></td>
    </tr>
    <tr>
      <th>pause_n</th>
      <td><p>Number of API calls after which a built-in pause is triggered. See Details.</p></td>
    </tr>
    <tr>
      <th>pause_secs</th>
      <td><p>Number of seconds to pause. See Details.</p></td>
    </tr>
    <tr>
      <th>write_sidecar</th>
      <td><p>Save table metadata in a separate file. See Details.</p></td>
    </tr>
    <tr>
      <th>stop_on_err</th>
      <td><p>Stop if the server returns an error</p></td>
    </tr>
    <tr>
      <th>quiet</th>
      <td><p>Suppress messages</p></td>
    </tr>
    <tr>
      <th>debug</th>
      <td><p>Print additional output at the console</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A remote tibble linked to the SQLite database.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>ca_getvals_db</code> fetches data from the Cal-Adapt API and writes the data to a SQLite database as they're received. This
allows you to fetch relatively large volumes of data in the background, and potentially over multiple sessions as it will
pick up where it left off if interrupted. Saving the values in a database also reduces the risk of exhausting your RAM.</p>
<p>Use <code>ca_getvals_db</code> to fetch large volumes of data (i.e., hundreds of thousands of values), or whenever you'd like
to keep  a local copy of the data. Note however for small amounts of data there is no advantage to putting it in a database
as it will be slighly slower to retrieve and work with.</p>
<p><code>db_fn</code> should be a file name with path to a SQLite database. A SQLIte database is a single file typically
with a <em>.db</em> or <em>.sqlite</em> extension. If the database doesn't exist, it will be created. If it already
exists, the new data will be added to it.</p>
<p><code>db_tbl</code> should the name of a table within the database where the new data will be saved. The table name should not
contain special characters and spaces are discouraged. If <code>new_recs_only = TRUE</code>, only new records will be
added to the database.</p>
<p><code>trans_len</code> defines the number of API calls per
<a href='https://www.sqlitetutorial.net/sqlite-transaction/'>SQLite transaction</a> (i.e. how many API calls of data to
accumulate before doing a write operation to the database). This can speed things up. Set it to 0 to disable transactions.</p>
<p>If <code>lookup_tbls = TRUE</code>, the database will create lookup tables for categorical columns such as GCM, scenario,
cvar, period, slug, etc. This can dramatically reduce the size of the SQLite database file and is generally recommended.
id <code>lookup_ret_joined = TRUE</code>, the tibble returned will have the lookup tables joined (i.e., column names will
be unaltered); if not the returned tibble will have id values for certain values. A small text file is created for each SQLite
database containing the names of the tables and SQL statement to join them (read automatically
by <code><a href='ca_db_read.html'>ca_db_read</a></code>).</p>
<p><code>indices</code> is a vector of column names in <code>db_tbl</code> that you'd like indexed (ignored if <code>lookup_tbls = FALSE</code>).
Creating indices can improve the performance of filters and joins when you generate summaries, but at the cost of a larger
database file and slightly slower write operations. Fields you can create indices on include <code>"feat_id"</code> (the location id value),
<code>"cvar"</code>, <code>"gcm"</code>, <code>"scenario"</code>, <code>"period"</code>, <code>"slug"</code>, and <code>"spag"</code>.</p>
<p>Indices can also be added to a SQLite database after downloading is complete with <a href='ca_db_indices.html'>ca_db_indices</a>. For large queries (e.g. thousands of
API calls), it is recommended to not build indices during the download process, and only add indices for those fields you
plan to filter on or join during your analysis. You can view which indices exist with <code><a href='ca_db_info.html'>ca_db_info</a></code>.</p>
<p><code>pause_n</code> is the number of API calls after which a built-in pause of length <code>pause_secs</code> is triggered. This is intended
to avoid disruption on the Cal-Adapt server. The maximum value for <code>pause_n</code> is 2500, and the minimum value
for <code>pause_secs</code> is 30 seconds.</p>
<p>The returned tibble is linked to the SQLite datbase. For the most part you can use the same dplyr functions to manipulate
the results, but to retrieve the actual values you need to use `collect()`. For more info working with a linked database,
see <a href='https://dbplyr.tidyverse.org/articles/dbplyr.html'>https://dbplyr.tidyverse.org/articles/dbplyr.html</a>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='ca_db_info.html'>ca_db_info</a></code>, <code><a href='ca_db_indices.html'>ca_db_indices</a></code>, <code><a href='ca_db_read.html'>ca_db_read</a></code>,</p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Andy Lyons, California Strategic Growth Council.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


