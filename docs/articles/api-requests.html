<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>API Requests • caladaptr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="API Requests">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">caladaptr</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/api-requests.html">API Requests</a></li>
    <li><a class="dropdown-item" href="../articles/large-queries.html">Large Queries</a></li>
    <li><a class="dropdown-item" href="../articles/rasters-pt1.html">Rasters Part I: Download, Combine, Subset, and Compute Pixel Summaries</a></li>
    <li><a class="dropdown-item" href="../articles/rasters-pt2.html">Rasters Part II: Six-Dimensional Climate Data Cubes and Spatial Queries</a></li>
    <li><a class="dropdown-item" href="../articles/rasters-pt3.html">Rasters Part III: Downloading Rasters for Large Areas</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-notebooks" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Notebooks</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-notebooks">
<li><a class="dropdown-item" href="https://ucanr-igis.github.io/caladaptr-res/notebooks/caladaptr_intro.nb.html">Introduction</a></li>
    <li><a class="dropdown-item" href="https://ucanr-igis.github.io/caladaptr-res/notebooks/chill.nb.html">Compute Chill</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-shiny-apps" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Shiny Apps</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-shiny-apps">
<li><a class="external-link dropdown-item" href="https://caladaptr.shinyapps.io/timeseries/">Annual Data Time Series</a></li>
    <li><a class="external-link dropdown-item" href="https://ucanr-igis.shinyapps.io/chill/">Projected Chill Hours</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ucanr-igis/caladaptr.apps/">caladpatr.apps package</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-videos" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Videos</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-videos">
<li><a class="external-link dropdown-item" href="https://youtu.be/6sDwXPbSYOQ">caladaptR Overview</a></li>
    <li><a class="external-link dropdown-item" href="https://youtu.be/APCIBs35BJg">Code Demo</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-workshops" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Workshops</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-workshops">
<li><a class="dropdown-item" href="https://ucanr-igis.github.io/caladaptr-res/workshops/ca_intro_apr22/">Working with Cal-Adapt Climate Data in R (April 2022)</a></li>
    <li><a class="dropdown-item" href="https://ucanr-igis.github.io/caladaptr-res/workshops/ca_intro_oct21/">Getting Started (Oct 2021)</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ucanr-igis/caladaptr/"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>API Requests</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ucanr-igis/caladaptr/blob/master/vignettes/api-requests.Rmd" class="external-link"><code>vignettes/api-requests.Rmd</code></a></small>
      <div class="d-none name"><code>api-requests.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Before you can fetch data of any kind from Cal-Adapt, you have to
construct an API request object. Creating an API request object is like
filling out an order form. Once completed, you feed the API request to a
function that actually retrieves data (either tabular or raster).</p>
<p>An API request object contains all the information needed to fetch
data, including the location(s) of interest, dataset(s), and time
period. In practice, you construct an API request object by stringing
together a series of functions that specify the different pieces of the
request. Examples:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ucanr-igis.github.io/caladaptr">caladaptr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Request modeled climate data (from Scripps)</span></span>
<span><span class="va">sac_minmaxtemp_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ca_loc_pt.html">ca_loc_pt</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">121.4687</span>, <span class="fl">38.5938</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>    <span class="co">## pointlocation(s)</span></span>
<span>  <span class="fu"><a href="../reference/ca_gcm.html">ca_gcm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HadGEM2-ES"</span>, <span class="st">"CNRM-CM5"</span>, <span class="st">"CanESM2"</span>,<span class="st">"MIROC5"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>          <span class="co">## GCM(s)</span></span>
<span>  <span class="fu"><a href="../reference/ca_scenario.html">ca_scenario</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rcp45"</span>,<span class="st">"rcp85"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                  <span class="co">## emission scenarios(s)</span></span>
<span>  <span class="fu"><a href="../reference/ca_cvar.html">ca_cvar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tasmin"</span>, <span class="st">"tasmax"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                   <span class="co">## climate variables</span></span>
<span>  <span class="fu"><a href="../reference/ca_period.html">ca_period</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                                <span class="co">## temporal aggregation period</span></span>
<span>  <span class="fu"><a href="../reference/ca_years.html">ca_years</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">1971</span>, end <span class="op">=</span> <span class="fl">2070</span><span class="op">)</span>                                   <span class="co">## start and end dates</span></span>
<span></span>
<span><span class="co">## Specify Livneh data (observed historical) for a HUC10 watershed</span></span>
<span><span class="va">huc_pr_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ca_loc_aoipreset.html">ca_loc_aoipreset</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"hydrounits"</span>,                    <span class="co">## Preset AOI</span></span>
<span>                               idfld <span class="op">=</span> <span class="st">"huc10"</span>,</span>
<span>                               idval <span class="op">=</span> <span class="st">"1809020409"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ca_livneh.html">ca_livneh</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                                  <span class="co">## Livneh data</span></span>
<span>  <span class="fu"><a href="../reference/ca_cvar.html">ca_cvar</a></span><span class="op">(</span><span class="st">"pr"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                                    <span class="co">## precipitation</span></span>
<span>  <span class="fu"><a href="../reference/ca_period.html">ca_period</a></span><span class="op">(</span><span class="st">"day"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                                 <span class="co">## daily</span></span>
<span>  <span class="fu"><a href="../reference/ca_dates.html">ca_dates</a></span><span class="op">(</span>start <span class="op">=</span> <span class="st">"1960-10-01"</span>, end <span class="op">=</span> <span class="st">"2010-09-30"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>               <span class="co">## start and end dates</span></span>
<span>  <span class="fu"><a href="../reference/ca_options.html">ca_options</a></span><span class="op">(</span>spatial_ag <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span>                                      <span class="co">## spatially aggregate w/ mean</span></span>
<span></span>
<span><span class="co">## Specify desired data by slug for irrigated water management districts</span></span>
<span><span class="va">irwm_ht_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ca_loc_aoipreset.html">ca_loc_aoipreset</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"irwm"</span>, idfld <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>     <span class="co">## Preset AOI</span></span>
<span>  <span class="fu"><a href="../reference/ca_slug.html">ca_slug</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exheat_year_ens32avg_historical"</span>,                         <span class="co">## slug(s)</span></span>
<span>            <span class="st">"exheat_year_ens32avg_rcp45"</span>,</span>
<span>            <span class="st">"exheat_year_ens32avg_rcp85"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ca_options.html">ca_options</a></span><span class="op">(</span>spatial_ag <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span>                                       <span class="co">## spatially aggregate w/ max</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level2">
<h2 id="specifying-location">Specifying Location<a class="anchor" aria-label="anchor" href="#specifying-location"></a>
</h2>
<p>All API requests must specify the location(s) of interest. Locations
can be specified by points, preset areas-of-interest, or user-provided
geoms. All of these options allow you to specify a primary key field
which will be included in the results so the results can be joined to
the input features.</p>
<p><br></p>
<p><em>1) Points</em></p>
<p>Point locations can be included using <code><a href="../reference/ca_loc_pt.html">ca_loc_pt()</a></code> if the
points are saved in a vector, matrix or data frame, and
<code><a href="../reference/ca_loc_sf.html">ca_loc_sf()</a></code> if the points are in a simple feature data
frame.</p>
<p>If points are passed in a matrix, vector or data frame, the first
column should be longitude (x), and the second column should be latitude
(y). Geographic coordinates are not required if the points are in a sf
data frame (but its a good idea). Example:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="../reference/ca_loc_pt.html">ca_loc_pt</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">122.1</span>, <span class="fl">38.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cal-Adapt API Request</span></span>
<span><span class="co">#&gt; Location(s): </span></span>
<span><span class="co">#&gt;   x: -122.1</span></span>
<span><span class="co">#&gt;   y: 38.1</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p><br></p>
<p><em>2) Preset areas-of-interest</em></p>
<p>The Cal-Adapt API is integrated with a number of preset polygon
areas-of-interest, also referred to as <em>boundary layers</em>. These
are things like county boundaries, census tracts, watersheds, etc. If
your study area(s) coincide with one of these layers, you can specify
them by name using <code><a href="../reference/ca_loc_aoipreset.html">ca_loc_aoipreset()</a></code>.</p>
<p>To see a list of the available preset layers, run:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoipreset_types</span></span>
<span><span class="co">#&gt;  [1] "censustracts"      "counties"          "cdistricts"        "ccc4aregions"      "climregions"       "hydrounits"        "irwm"             </span></span>
<span><span class="co">#&gt;  [8] "electricutilities" "wecc-load-area"    "evtlocations"      "place"</span></span></code></pre></div>
<p>When you use a preset AOI layer in an API request, you can specify
which feature(s) you’re interested in (if you don’t want them all). For
example if you want data summarized by county, you can specify which of
the over 50 counties in California you’re interested in. Two arguments
must be passed to specify features of interest: i) <code>idfld</code> (a
field in the attribute table that has unique values), and ii)
<code>idval</code> (the id numbers or values of the features).
Example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="../reference/ca_loc_aoipreset.html">ca_loc_aoipreset</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"counties"</span>, idfld <span class="op">=</span> <span class="st">"fips"</span>, idval <span class="op">=</span> <span class="st">"06013"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cal-Adapt API Request</span></span>
<span><span class="co">#&gt; Location(s): </span></span>
<span><span class="co">#&gt;   AOI Preset: counties</span></span>
<span><span class="co">#&gt;   fips(s): 06013</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>To figure out which fields are available to specify locations for a
given preset layer, you can use the built-in constant
<code>aoipreset_idflds</code>. For example if you’re interested in
counties, you can use the following fields:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoipreset_idflds</span><span class="op">$</span><span class="va">counties</span></span>
<span><span class="co">#&gt; [1] "fips" "id"</span></span></code></pre></div>
<p>To see the valid values to specify features, use the built-in
constant <code>aoipreset_idval</code>. For example, the ‘Counties’
preset layer has a column named ‘fips’ you can use to specify which
county(s) you’re interested in. The values look like:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoipreset_idval</span><span class="op">$</span><span class="va">counties</span><span class="op">$</span><span class="va">fips</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "06001" "06003" "06005" "06007" "06009" "32510"</span></span></code></pre></div>
<p><br></p>
<p>All the preset areas of interest can be imported as sf objects using
<code><a href="../reference/ca_aoipreset_geom.html">ca_aoipreset_geom()</a></code>. For example the climate regions for
the 5th climate change assessment look like:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ca_climregions_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ca_aoipreset_geom.html">ca_aoipreset_geom</a></span><span class="op">(</span><span class="st">"climregions"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `climregions' from data source `C:\Users\Andy\AppData\Local\R\cache\R\caladaptr\climregions.gpkg' using driver `GPKG'</span></span>
<span><span class="co">#&gt; Simple feature collection with 11 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -13848750 ymin: 3833695 xmax: -12705800 ymax: 5163721</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / Pseudo-Mercator</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ca_climregions_sf</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/ca_climregions_sf_ggplot-1.png" alt="Climate Regions Preset Areas-of-Interest"></p>
<p><br></p>
<p><em>3) User-provided sf features</em></p>
<p>If Cal-Adapt’s preset areas-of-interest don’t align with your study
area(s), you can provide your own locations as a simple feature data
frame. Your sf object should have a column with unique values (like
OBJECTID) to join the input features to the Cal-Adapt data.</p>
<p>Add locations from a sf object to an API request with
<code><a href="../reference/ca_loc_sf.html">ca_loc_sf()</a></code>. POINT, POLYGON, and MULTIPOLYGON geometries
are supported. Lines are not supported, and multipoint features must be
converted to simple point features (see <code>st_cast</code>). The
<code>idfld</code> argument specifies a column in the sf object that
contains unique values. If the sf object lacks a column with unique
values, you can add one using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>, or provide a vector
of unique id values with <code>idval</code>.</p>
<p>The Cal-Adapt API has limits as to how large a spatial area can be
queried. If your area-of-interest is larger than a county, consider
blocking the area with <code><a href="../reference/ca_biggeom_blocks.html">ca_biggeom_blocks()</a></code>. If your
locations include multiple points per 6km LOCA grid cell (Cal-Adapt’s
smallest spatial unit), you can group them and just make one call per
grid cell (see the <a href="large-queries-sqlite.html">Large Queries</a>
vignette for sample code).</p>
<p>In the next example, we get a sf data frame of the Congressional
Districts, and use it to start an API request object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Get Congressional Districts as a sf object</span></span>
<span><span class="op">(</span><span class="va">cdistricts_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ca_aoipreset_geom.html">ca_aoipreset_geom</a></span><span class="op">(</span><span class="st">"cdistricts"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 66 features and 9 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -13866650 ymin: 3675964 xmax: -12138860 ymax: 6275056</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / Pseudo-Mercator</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    statefp cd114fp      affgeoid geoid lsad cdsessn        aland     awater id                           geom</span></span>
<span><span class="co">#&gt; 1       06      11 5001400US0611  0611   C2     114   1278249894   92424585  1 MULTIPOLYGON (((-13628819 4...</span></span>
<span><span class="co">#&gt; 2       06      41 5001400US0641  0641   C2     114    819873792    4240410  2 MULTIPOLYGON (((-13086531 4...</span></span>
<span><span class="co">#&gt; 3       16      02 5001400US1602  1602   C2     114 111948989280 1081502469  3 MULTIPOLYGON (((-12950296 5...</span></span>
<span><span class="co">#&gt; 4       06      50 5001400US0650  0650   C2     114   7219205047   43666727  4 MULTIPOLYGON (((-13053482 3...</span></span>
<span><span class="co">#&gt; 5       06      16 5001400US0616  0616   C2     114   7354278768  118616551  5 MULTIPOLYGON (((-13497338 4...</span></span>
<span><span class="co">#&gt; 6       49      02 5001400US4902  4902   C2     114 103638076153 2945583941  6 MULTIPOLYGON (((-12696318 4...</span></span>
<span><span class="co">#&gt; 7       06      49 5001400US0649  0649   C2     114   1432623041  512378639  7 MULTIPOLYGON (((-13105979 3...</span></span>
<span><span class="co">#&gt; 8       06      08 5001400US0608  0608   C2     114  85126210480  450307265  8 MULTIPOLYGON (((-13319259 4...</span></span>
<span><span class="co">#&gt; 9       06      20 5001400US0620  0620   C2     114  12624185548 1574913163  9 MULTIPOLYGON (((-13589114 4...</span></span>
<span><span class="co">#&gt; 10      06      32 5001400US0632  0632   C2     114    321774529    5320498 10 MULTIPOLYGON (((-13143818 4...</span></span>
<span></span>
<span><span class="co">## Start an API request object</span></span>
<span><span class="op">(</span><span class="fu"><a href="../reference/ca_loc_sf.html">ca_loc_sf</a></span><span class="op">(</span>loc <span class="op">=</span> <span class="va">cdistricts_sf</span>, idfld <span class="op">=</span> <span class="st">"geoid"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cal-Adapt API Request</span></span>
<span><span class="co">#&gt; Location(s): </span></span>
<span><span class="co">#&gt;   Simple Feature MULTIPOLYGON (66 feature(s))</span></span>
<span><span class="co">#&gt;   ID field: geoid</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="datasets">Datasets<a class="anchor" aria-label="anchor" href="#datasets"></a>
</h2>
<p>A Cal-Adapt API request must also specify the data layers(s) to
retrieve. A description of the datasets on Cal-Adapt is beyond the scope
of this vignette, but some general guidelines include:</p>
<ol style="list-style-type: lower-roman">
<li><p>Review the <a href="https://cal-adapt.org/data/" class="external-link">data
documentation</a> on Cal-Adapt, including the <a href="https://cal-adapt.org/blog/2020/webinar-jan-2020/" class="external-link">Introduction to
Climate Data</a> webinar.</p></li>
<li><p>A local copy of Cal-Adapt data catalog can be retrieved from
<code><a href="../reference/ca_catalog_rs.html">ca_catalog_rs()</a></code>, which returns a tibble. One way to find a
dataset for your project is to view the catalog in a RStudio viewer pane
and use the filter tool to find specific datasets.</p></li>
</ol>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu"><a href="../reference/ca_catalog_rs.html">ca_catalog_rs</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<ol start="3" style="list-style-type: lower-roman">
<li>To search for data layers and view their properties, you can use
<code><a href="../reference/ca_catalog_search.html">ca_catalog_search()</a></code>, passing it keywords or a slug. Partial
matches are returned as well.</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ca_catalog_search.html">ca_catalog_search</a></span><span class="op">(</span><span class="st">"pr_day_gridmet"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; pr_day_gridmet</span></span>
<span><span class="co">#&gt;   name: gridMET daily precipitation historical</span></span>
<span><span class="co">#&gt;   url: https://api.cal-adapt.org/api/series/pr_day_gridmet/</span></span>
<span><span class="co">#&gt;   tres: daily</span></span>
<span><span class="co">#&gt;   begin: 1979-01-01T00:00:00Z</span></span>
<span><span class="co">#&gt;   end: 2020-12-31T00:00:00Z</span></span>
<span><span class="co">#&gt;   units: mm</span></span>
<span><span class="co">#&gt;   num_rast: 1</span></span>
<span><span class="co">#&gt;   id: 338</span></span>
<span><span class="co">#&gt;   xmin: -124.579167</span></span>
<span><span class="co">#&gt;   xmax: -113.370833</span></span>
<span><span class="co">#&gt;   ymin: 31.545833</span></span>
<span><span class="co">#&gt;   ymax: 43.754167</span></span></code></pre></div>
<div class="section level3">
<h3 id="specifying-datasets">Specifying Datasets<a class="anchor" aria-label="anchor" href="#specifying-datasets"></a>
</h3>
<p>Once you’ve identified which dataset you need, add functions to the
Cal-Adapt API request. The groups of functions you use to specify
datasets fall in three categories: 1) one of the main climate models, 2)
observed climate data, and 3) slugs.</p>
<p><br></p>
<p><strong>Modeled Climate Data</strong></p>
<p>Many of Cal-Adapt’s datasets are based on the direct output of global
climate models (e.g., temperature, precipitation) or their derivatives
(e.g., snow water equivalent, evaoptranspiration). These models have
been used to predict both future and historic conditions based on
specific emissions scenarios. API requests for modeled climate data
should include:</p>
<ul>
<li>climate variable(s) - e.g., tasmin, tasmax, pr, et, etc.</li>
<li>GCM(s)</li>
<li>emissions scenario(s)</li>
<li>temporal period - e.g., year, day, month</li>
</ul>
<p>To help you construct an API request for modeled climate data, the
following built-in constants provide valid values. Note that not all
combinations have an existing dataset.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvars</span></span>
<span><span class="co">#&gt;  [1] "tasmax"     "tasmin"     "pr"         "swe"        "baseflow"   "et"         "rainfall"   "runoff"     "snowfall"   "soilMoist1"</span></span>
<span><span class="co">#&gt; [11] "Tair"</span></span>
<span></span>
<span><span class="va">gcms</span></span>
<span><span class="co">#&gt;  [1] "HadGEM2-ES" "CNRM-CM5"   "CanESM2"    "MIROC5"     "ACCESS1-0"  "CCSM4"      "CESM1-BGC"  "CMCC-CMS"   "GFDL-CM3"   "HadGEM2-CC"</span></span>
<span><span class="co">#&gt; [11] "ens32avg"   "ens32max"   "ens32min"</span></span>
<span></span>
<span><span class="va">scenarios</span></span>
<span><span class="co">#&gt; [1] "rcp45"      "rcp85"      "historical"</span></span>
<span></span>
<span><span class="va">periods</span></span>
<span><span class="co">#&gt; [1] "day"    "month"  "year"   "30yavg"</span></span></code></pre></div>
<p>Example:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="../reference/ca_cvar.html">ca_cvar</a></span><span class="op">(</span>cvar <span class="op">=</span> <span class="st">"tasmin"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ca_gcm.html">ca_gcm</a></span><span class="op">(</span>gcm <span class="op">=</span> <span class="va">gcms</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ca_scenario.html">ca_scenario</a></span><span class="op">(</span><span class="st">"rcp85"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ca_period.html">ca_period</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cal-Adapt API Request</span></span>
<span><span class="co">#&gt; Location(s): NA</span></span>
<span><span class="co">#&gt; Variable(s): tasmin</span></span>
<span><span class="co">#&gt; Temporal aggregration period(s): year</span></span>
<span><span class="co">#&gt; GCM(s): HadGEM2-ES, CNRM-CM5, CanESM2, MIROC5</span></span>
<span><span class="co">#&gt; Scenario(s): rcp85</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p><br></p>
<p><strong>Observed Data</strong></p>
<p>Livneh data are based on historic records that have been spatially
interpolated. To specify a Livneh dataset, include
<code><a href="../reference/ca_livneh.html">ca_livneh()</a></code> in the request and omit GCMs and emission
scenarios:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">ex2_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ca_cvar.html">ca_cvar</a></span><span class="op">(</span>cvar <span class="op">=</span> <span class="st">"pr"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ca_livneh.html">ca_livneh</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ca_period.html">ca_period</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cal-Adapt API Request</span></span>
<span><span class="co">#&gt; Location(s): NA</span></span>
<span><span class="co">#&gt; Variable(s): pr</span></span>
<span><span class="co">#&gt; Temporal aggregration period(s): year</span></span>
<span><span class="co">#&gt; Livneh data: TRUE</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p><br></p>
<p><strong>Slugs</strong></p>
<p>Each of the nearly 950 raster series available through the Cal-Adapt
API has a unique <code>slug</code>, or short name. You can look up slugs
in the Cal-Adapt catalog (<code><a href="../reference/ca_catalog_rs.html">ca_catalog_rs()</a></code>).</p>
<p>If the dataset you’re interested in can’t be specified using the
functions above, you can use <code><a href="../reference/ca_slug.html">ca_slug()</a></code> to specify it by its
slug. With <code><a href="../reference/ca_slug.html">ca_slug()</a></code>, you don’t have to include the climate
variable, period, GCM, or scenario - those are all implied by the slug.
But you’ll still need to specify a location and optionally dates for the
API request to be complete.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="../reference/ca_slug.html">ca_slug</a></span><span class="op">(</span>slug <span class="op">=</span> <span class="st">"exheat_year_ens32avg_historical"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cal-Adapt API Request</span></span>
<span><span class="co">#&gt; Location(s): NA</span></span>
<span><span class="co">#&gt; Slug(s): exheat_year_ens32avg_historical</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="dates">Dates<a class="anchor" aria-label="anchor" href="#dates"></a>
</h2>
<p>Date ranges are optional in API requests. If a date range is not
provided, data for the entire time range of the dataset will be
returned. You can include a date range with <code><a href="../reference/ca_dates.html">ca_dates()</a></code> or
<code><a href="../reference/ca_years.html">ca_years()</a></code>. Enter years as integers, and dates as character
values <code>"yyyy-mm-dd"</code>. Examples:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="../reference/ca_years.html">ca_years</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">2035</span>, end <span class="op">=</span> <span class="fl">2065</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cal-Adapt API Request</span></span>
<span><span class="co">#&gt; Location(s): NA</span></span>
<span><span class="co">#&gt; Dates: 2035-01-01 to 2065-12-31</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="op">(</span><span class="fu"><a href="../reference/ca_dates.html">ca_dates</a></span><span class="op">(</span>start <span class="op">=</span> <span class="st">"2050-03-15"</span>, end <span class="op">=</span> <span class="st">"2070-10-31"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cal-Adapt API Request</span></span>
<span><span class="co">#&gt; Location(s): NA</span></span>
<span><span class="co">#&gt; Dates: 2050-03-15 to 2070-10-31</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="options">Options<a class="anchor" aria-label="anchor" href="#options"></a>
</h2>
<p><code><a href="../reference/ca_options.html">ca_options()</a></code> is how you specify any other options for
the request. Currently the only option in use is
<code>spatial_ag</code>. <code>spatial_ag</code> is the spatial
aggregation function that should be used when querying polygon areas. If
a feature intersects more than one LOCA grid cell, this function will be
used to collapse the grid cells into one value.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="../reference/ca_options.html">ca_options</a></span><span class="op">(</span>spatial_ag <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cal-Adapt API Request</span></span>
<span><span class="co">#&gt; Location(s): NA</span></span>
<span><span class="co">#&gt; Options:</span></span>
<span><span class="co">#&gt;   spatial ag: mean</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="checking-the-integrity-of-an-api-request">Checking the integrity of an API request<a class="anchor" aria-label="anchor" href="#checking-the-integrity-of-an-api-request"></a>
</h2>
<p>Before you use an API request to fetch data, there are a couple of
things you can do to check its validity.</p>
<p>To verify the API request covers the correct location, you can plot
it. Below we plot a sample API request returned by
<code><a href="../reference/ca_example_apireq.html">ca_example_apireq()</a></code>. Adding <code>locagrid = TRUE</code>
overlay the actual LOCA grid cells.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">samp_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ca_example_apireq.html">ca_example_apireq</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cal-Adapt API Request</span></span>
<span><span class="co">#&gt; Location(s): </span></span>
<span><span class="co">#&gt;   Simple Feature POLYGON (1 feature(s))</span></span>
<span><span class="co">#&gt;   ID field: id</span></span>
<span><span class="co">#&gt; Variable(s): pr</span></span>
<span><span class="co">#&gt; Temporal aggregration period(s): day</span></span>
<span><span class="co">#&gt; GCM(s): CCSM4</span></span>
<span><span class="co">#&gt; Scenario(s): rcp85</span></span>
<span><span class="co">#&gt; Dates: 2010-01-01 to 2012-12-31</span></span>
<span><span class="co">#&gt; Options:</span></span>
<span><span class="co">#&gt;   spatial ag: mean</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># Omit `static = TRUE` to get an interactive leaflet map</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">samp_cap</span>, locagrid <span class="op">=</span> <span class="cn">TRUE</span>, static <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/samp_cap_plot-1.png" alt="Plot of an API request"></p>
<p><br></p>
<p><code><a href="../reference/ca_preflight.html">ca_preflight()</a></code> does a more complete check of an API
request, double-checking that it refers to an existing dataset, data are
available for the requested date range, the request doesn’t have
conflicting elements, it isn’t too big, etc. Some warnings are specific
to fetching values vs fetching rasters, and are reported
accordingly:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ca_example_apireq.html">ca_example_apireq</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/ca_preflight.html">ca_preflight</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; General issues</span></span>
<span><span class="co">#&gt;  - none found</span></span>
<span><span class="co">#&gt; Issues for querying values</span></span>
<span><span class="co">#&gt;  - none found</span></span>
<span><span class="co">#&gt; Issues for downloading rasters</span></span>
<span><span class="co">#&gt;  - none found</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andy Lyons.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
